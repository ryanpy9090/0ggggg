<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYAN AI GPT 1</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <!-- Ionicons for icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>

    <div class="background-orb orb-1"></div>
    <div class="background-orb orb-2"></div>

    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="logo">
                <img src="logo.png" alt="Ryan AI" id="app-logo">
            </div>

            <ul class="nav-links">
                <li class="active" data-target="home">
                    <ion-icon name="home-outline"></ion-icon>
                    <span class="tooltip">Home</span>
                </li>
                <li data-target="library">
                    <ion-icon name="library-outline"></ion-icon>
                    <span class="tooltip">Library</span>
                </li>
                <li data-target="chat">
                    <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
                    <span class="tooltip">Ryan AI</span>
                </li>
            </ul>

            <div class="settings">
                <ion-icon name="settings-outline"></ion-icon>
            </div>
        </nav>

        <!-- MAIN CONTENT AREA -->
        <main class="content-area">

            <!-- MODULE: HOME DASHBOARD -->
            <section id="home" class="module active">
                <header>
                    <h1>RYAN AI // HOME</h1>
                    <p>SYSTEM STATUS: OPTIMAL // NEURAL NET: ONLINE</p>
                </header>
                <div class="dashboard-grid">
                    <div class="dash-card chat-card" onclick="switchTab('chat')">
                        <ion-icon name="chatbubbles-outline"></ion-icon>
                        <h3>Ryan Chat</h3>
                        <p>Interact with the advanced Ryan AI LLM interface.</p>
                    </div>
                </div>
            </section>

            <!-- MODULE: LIBRARY -->
            <section id="library" class="module">
                <header>
                    <h1>CHAT LIBRARY</h1>
                    <p>YOUR CONVERSATION HISTORY</p>
                </header>
                <div class="library-container">
                    <div class="library-header">
                        <button id="new-chat-btn" class="primary-btn"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 0.75rem 1.5rem; font-size: 1rem;">
                            <ion-icon name="add-circle-outline"
                                style="vertical-align: middle; margin-right: 0.5rem;"></ion-icon>
                            New Chat
                        </button>
                    </div>
                    <div id="chat-list" class="chat-list">
                        <!-- Chat items will be dynamically inserted here -->
                    </div>
                </div>
            </section>

            <!-- MODULE: CHAT -->
            <section id="chat" class="module">
                <header>
                    <h1>RYAN AI GPT 1</h1>
                    <select id="chat-provider" class="provider-select">
                        <option value="openai">ChatGPT</option>
                        <option value="gemini">Gemini Pro</option>
                    </select>
                </header>
                <div class="chat-interface">
                    <div class="chat-history" id="chat-history">
                        <div class="msg ai">
                            <div class="avatar"><ion-icon name="planet"></ion-icon></div>
                            <div class="bubble">Hello. I am Cortex. How can I assist you today?</div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Type /image [prompt] or /video [prompt]...">
                        <button id="send-chat-btn">SEND <ion-icon name="send"></ion-icon></button>
                    </div>
                </div>
            </section>

            <!-- HIDDEN: VIDEO GEN (Logic remains for /video command, but UI is hidden) -->
            <section id="video" class="module" style="display:none;">
                <header>
                    <h1>VIDEO GEN (Background)</h1>
                </header>
                <div class="workspace">
                    <div class="preview-stage" id="video-stage">
                        <div class="loading-bar" id="video-progress" hidden>
                            <div class="bar-fill"></div>
                            <span class="status-text">RENDERING FRAMES...</span>
                        </div>
                    </div>
                    <textarea id="video-prompt"></textarea>
                    <button id="generate-video-btn">GENERATE</button>
                </div>
            </section>

        </main>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <header>
                <h2>SYSTEM CONFIG</h2>
                <button class="close-modal"><ion-icon name="close-outline"></ion-icon></button>
            </header>
            <div class="modal-body">
                <div class="input-group">
                    <label>OPENAI API KEY</label>
                    <input type="password" id="openai-key" placeholder="sk-...">
                </div>
                <div class="input-group">
                    <label>GEMINI API KEY</label>
                    <input type="password" id="gemini-key" placeholder="Enter Gemini Key...">
                </div>
                <div class="input-group">
                    <label>HUGGINGFACE TOKEN</label>
                    <input type="password" id="hf-key" placeholder="hf_...">
                </div>
                <p class="crypto-note">Keys are synced securely to your account.</p>
                <button id="save-settings" class="primary-btn">SAVE CONFIG</button>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e0e0e0;">
                    <div id="user-info" style="margin-bottom: 1rem; color: #7f8c8d; font-size: 0.9rem;">
                        <p><strong>Signed in as:</strong> <span id="user-email">Loading...</span></p>
                    </div>
                    <button onclick="signOutUser()" class="primary-btn" style="background: #ff4757; width: 100%;">
                        <ion-icon name="log-out-outline"
                            style="vertical-align: middle; margin-right: 0.5rem;"></ion-icon>
                        SIGN OUT
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Authentication & Sync -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDummy-Replace-With-Your-Firebase-Config",
            authDomain: "ryan-ai-gpt.firebaseapp.com",
            projectId: "ryan-ai-gpt",
            storageBucket: "ryan-ai-gpt.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.currentUser = null;

        // Check authentication state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.currentUser = user;
                console.log('User signed in:', user.email);

                // Load user data from Firestore
                try {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();

                        // Sync chats from cloud
                        if (userData.chats) {
                            localStorage.setItem('ryan_chats', JSON.stringify(userData.chats));
                            if (window.loadChatList) window.loadChatList();
                        }

                        // Sync API keys
                        if (userData.apiKeys) {
                            if (userData.apiKeys.openai) localStorage.setItem('openai_key', userData.apiKeys.openai);
                            if (userData.apiKeys.gemini) localStorage.setItem('gemini_key', userData.apiKeys.gemini);
                            if (userData.apiKeys.hf) localStorage.setItem('hf_key', userData.apiKeys.hf);
                        }
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            } else {
                // No user signed in, redirect to auth page
                window.location.href = 'auth.html';
            }
        });

        // Sync data to cloud
        window.syncToCloud = async function () {
            if (!window.currentUser) return;

            try {
                const chats = JSON.parse(localStorage.getItem('ryan_chats') || '[]');
                const apiKeys = {
                    openai: localStorage.getItem('openai_key') || '',
                    gemini: localStorage.getItem('gemini_key') || '',
                    hf: localStorage.getItem('hf_key') || ''
                };

                await setDoc(doc(db, 'users', window.currentUser.uid), {
                    chats: chats,
                    apiKeys: apiKeys,
                    lastSync: new Date().toISOString()
                }, { merge: true });

                console.log('Data synced to cloud');
            } catch (error) {
                console.error('Error syncing to cloud:', error);
            }
        };

        // Auto-sync every 30 seconds
        setInterval(() => {
            if (window.currentUser) {
                window.syncToCloud();
            }
        }, 30000);

        // Add sign out button functionality
        window.signOutUser = async function () {
            if (confirm('Sign out from Ryan AI?')) {
                await window.syncToCloud(); // Final sync before logout
                await signOut(auth);
                window.location.href = 'auth.html';
            }
        };
    </script>

    <script src="script.js"></script>
</body>

</html>